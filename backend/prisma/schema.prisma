generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}

enum UserRole {
  BUYER
  SELLER
  ADMIN
}

enum ProductCondition {
  NEW
  LIKE_NEW
  GOOD
  FAIR
  POOR
}

enum PurchaseStatus {
  PENDING
  COMPLETED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  CASH
  CARD
  PIX
  OTHER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole
  avatarUrl String?
  phone     String?
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products  Product[]  @relation("SellerProducts")
  sales     Purchase[] @relation("SellerSales")
  purchases Purchase[] @relation("BuyerPurchases")
}

model Product {
  id          String           @id @default(uuid())
  sellerId    String
  seller      User             @relation("SellerProducts", fields: [sellerId], references: [id])
  
  name        String
  description String
  price       Decimal          @db.Decimal(10, 2)
  currency    String           @default("BRL")
  imageUrl    String?
  
  category    String?
  condition   ProductCondition?
  
  qrCode      String           @unique
  
  isAvailable Boolean          @default(true)
  isSold      Boolean          @default(false)
  
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  purchases   Purchase[]
}

model Purchase {
  id            String         @id @default(uuid())
  
  productId     String
  product       Product        @relation(fields: [productId], references: [id])
  
  buyerId       String
  buyer         User           @relation("BuyerPurchases", fields: [buyerId], references: [id])
  
  sellerId      String
  seller        User           @relation("SellerSales", fields: [sellerId], references: [id])
  
  price         Decimal        @db.Decimal(10, 2)
  currency      String         @default("BRL")
  
  status        PurchaseStatus @default(PENDING)
  paymentMethod PaymentMethod?
  
  purchaseDate  DateTime       @default(now())
  notes         String?
  
  qrCodeScanned Boolean        @default(false)

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}
